<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peringatan Banjir Rob Indonesia</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: sans-serif; }
        #map { width: 100%; height: 100vh; }
        
        .info-panel {
            padding: 15px;
            background: white;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 300px;
        }
        .legend {
            font-size: 12px;
            margin-top: 10px;
            color: #555;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="info-panel">
        <h3>ðŸš¨ Pantau Banjir Rob</h3>
        <p>Klik wilayah di peta untuk simulasi status peringatan.</p>
        <hr>
        <div id="status-wilayah">
            <strong>Wilayah:</strong> - <br>
            <strong>Status:</strong> -
        </div>
        <div class="legend">
            *Data ini hanya simulasi untuk ujicoba.
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        // 1. Inisialisasi Peta
        var map = L.map('map').setView([-2.5489, 118.0149], 5);

        // 2. Tambahkan Basemap
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap contributors, Â© CARTO',
            maxZoom: 19
        }).addTo(map);

        var geojsonLayer;

        // 3. Style Default (Abu-abu)
        function styleDefault(feature) {
            return {
                fillColor: '#bdc3c7', 
                weight: 1,
                opacity: 1,
                color: 'white',
                fillOpacity: 0.6
            };
        }

        // 4. Style Highlight (Merah - Tanda Bahaya)
        function styleHighlight(feature) {
            return {
                fillColor: '#e74c3c', // Merah Aler
                weight: 2,
                opacity: 1,
                color: '#c0392b',
                fillOpacity: 0.9
            };
        }

        // 5. Interaksi saat diklik
        function saatDiklik(e) {
            var layer = e.target;
            var props = layer.feature.properties;

            // Debugging: Cek nama kolom di Console browser
            console.log("Data Atribut Wilayah Ini:", props);

            // Reset style layer lain, highlight yang diklik
            geojsonLayer.resetStyle();
            layer.setStyle(styleHighlight());
            layer.bringToFront();

            // --- LOGIKA MENCARI NAMA WILAYAH ---
            // Karena tiap data SHP punya nama kolom beda (misal: NAMOBJ, WADMKK, NAME_2, KABUPATEN)
            // Script ini mencoba mencari mana yang ada isinya.
            var namaDaerah = props.KABUPATEN || props.WADMKK || props.NAMOBJ || props.NAME_2 || props.kabupaten || "Nama tidak terdeteksi";
            var kodeDaerah = props.ID || props.KODE || "-";

            // Update Panel Info
            var htmlInfo = "<strong>Wilayah:</strong> " + namaDaerah + "<br>" +
                           "<span style='color:red; font-weight:bold'>Status: AWAS (Simulasi)</span>";
            document.getElementById('status-wilayah').innerHTML = htmlInfo;
            
            // Tampilkan Popup
            layer.bindPopup("<b>" + namaDaerah + "</b><br>Potensi Banjir Rob: Tinggi").openPopup();
        }

        function onEachFeature(feature, layer) {
            layer.on({
                click: saatDiklik
            });
        }

        // 6. Memuat File JSON
        // PERHATIKAN: Nama file disesuaikan di sini
        fetch('IdKabupaten.json') 
            .then(response => {
                if (!response.ok) {
                    throw new Error("HTTP error " + response.status);
                }
                return response.json();
            })
            .then(data => {
                geojsonLayer = L.geoJson(data, {
                    style: styleDefault,
                    onEachFeature: onEachFeature
                }).addTo(map);
                
                // Zoom otomatis ke area data
                map.fitBounds(geojsonLayer.getBounds());
            })
            .catch(error => {
                console.error("Error loading JSON:", error);
                alert("Gagal memuat peta 'IdKabupaten.json'. Cek nama file di GitHub kamu (huruf besar/kecil berpengaruh)!");
            });

    </script>
</body>
</html>
